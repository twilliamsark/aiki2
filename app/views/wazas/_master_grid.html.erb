<% recent_only ||= false %>
<h1><%= local_title %></h1>

<div class="row pad_top pad_sides aiki_box">
  <div class="col-md-12">
    <table class="table table-striped table-bordered">
      <thead class="rank_row">
        <th><strong>Waza \ Format</strong></th>
        <% format_names.each do |format_name| %>
          <th><%= format_name %></th>
        <% end %>
      </thead>
      <tbody>
        <%
        master_hash.each do |waza, format_hash|
        %>
          <tr>
          <td><strong><%= waza %></strong></td>
          <%
          format_names.each do |format_name|
            waza_formats = format_hash[format_name]
            if waza_formats && waza_formats.any?
              waza_formats = waza_formats.sort{|x,y| x.rank.position <=> y.rank.position}
          %>
                <td>

                  <%
                  waza_formats.each do |waza_format|
                    videos = recent_only ? waza_format.videos.recent : waza_format.videos
                    data = "#{waza_format.rank_name} - #{videos.size} Video(s)"
                    if waza == "Iaido Only"
                      data = "#{waza_format.waza.short_description} - " + data
                    end
                  %>
                    <% if videos.any? %>
                      <%= link_to data, aikido_path(waza: waza_format.waza, video: waza_format.first_video(recent_only: recent_only)) %>
                    <% else %>
                      <%= link_to data, aikido_path(waza: waza_format.waza, format_type: waza_format.format) %>
                    <% end %>
                    <% unless waza_format == waza_formats.last %>
                      <br/>
                      <br/>
                    <% end %>
                  <% end %>

                </td>
            <% else %>
                <td>0</td>
          <%
            end
          end
          %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
