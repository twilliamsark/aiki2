<div id="video_list" style="margin-top: -5px;">

  <h3>Select an <%= type.titleize %> Video</h3>
  <h4>by <%= sort_by.pluralize %></h4>

  <% if selection && selection.any? %>
    <div class="panel-group" id="accordion">
      <%
        first = true

        keys.each do |key|
          techniques = selection[key]

          if key == 'Search Results'
            id = 'search_results'
            name = "Search Results"
            description = @search_term || ''
          else
            id = key.id
            name = key.name
            description = key.description
          end
      %>
        <div class="panel panel-default">

          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion" href="#collapse<%= id %>">
                <ul>
                  <li class="no_bullet_list"><%= name %></li>
                  <li class="no_bullet_list_indented"><%= description %></li>
                </ul>
              </a>
            </h4>
          </div>

          <div id="collapse<%= id %>" class="panel-collapse collapse<%= first ? ' in' : '' %>">
            <% first = false %>
            <div class="panel-body">
              <ul>
                <% techniques.each do |t| %>
                  <%
                  #TODO Clean this up, make a helper
                    name = t.list_name
                    if sort_by == 'Rank'
                      wfs = WazaFormat.where(waza: t, rank: key)
                      if wfs
                        v = wfs.first.first_video
                        format_string = wfs.map{|wf| wf.format.name}.uniq.join(', ')
                      end
                    end
                  %>
                  <li class="no_bullet_list" style="padding-bottom: 2px;">
                    <%= link_to "#{name}", remote_waza_url(waza: t, video: v), remote: true %>
                    <%= " - #{format_string}" if format_string.present? %>
                  </li>
                <% end %>
              </ul>
            </div>
          </div>

        </div>

      <% end %>
    </div>
  <% end %>
</div>
