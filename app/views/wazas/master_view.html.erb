<h1>Master Grid</h1>

<%
  format_names = Format.all.sort_by(&:position).map(&:name)
%>

<div class="row pad_top pad_sides aiki_box">
  <div class="col-md-12">
    <table class="table table-striped table-bordered">
      <thead class="rank_row">
        <th><strong>Waza/Format</strong></th>
        <% format_names.each do |format_name| %>
          <th><%= format_name %></th>
        <% end %>
      </thead>
      <tbody>
        <%
        master = Waza.master_hash
        master.each do |waza, format_hash|
        %>
          <tr>
          <td><strong><%= waza %></strong></td>
          <%
          format_names.each do |format_name|
            waza_formats = format_hash[format_name]
            if waza_formats && waza_formats.any?
              waza_formats = waza_formats.sort{|x,y| x.rank.position <=> y.rank.position}
          %>
                <td>

                  <%
                  waza_formats.each do |waza_format|
                    data = "#{waza_format.rank_name} - #{waza_format.videos.size} Video(s)"
                  %>
                    <% if waza_format.videos.any? %>
                      <%= link_to data, aikido_path(waza: waza_format.waza, video: waza_format.first_video) %>
                    <% else %>
                      <%= link_to data, aikido_path(waza: waza_format.waza, format_type: waza_format.format) %>
                    <% end %>
                    <% unless waza_format == waza_formats.last %>
                      <br/>
                      <br/>
                    <% end %>
                  <% end %>


                </td>
            <% else %>
                <td>0</td>
          <%
            end
          end
          %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>



